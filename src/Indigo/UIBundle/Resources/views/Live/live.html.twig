<!DOCTYPE html>
<html>
<head>

    <link rel="stylesheet" href="{{ asset('bundles/indigomain/css/bootstrap.min.css') }}" />
    <link rel="stylesheet" href="{{ asset('bundles/indigoui/css/main.css') }}" />
    <srip src="{{ asset('bundles/indigomain/js/bootstrap.min.js') }}"></srip>
    <script src="//code.jquery.com/jquery-1.11.2.min.js"></script>


</head>

<script>

    var _lastScoreTeamA = 0;
    var _lastScoreTeamB = 0;
    var _firstTime = true;


    $(document).ready(function()
    {
        setInterval(function () {

            var status = $.get( "/live/status/1", function(data) {

                var json = $.parseJSON(data);

                if(json.isBusy)
                {
                    $("#ajax-table-status").html("Stalas UÅ½IMTAS!");
                    $("#ajax-table-status").addClass('busy');
                }
                else
                {
                    $("#ajax-table-status").html("Stalas LAISVAS!");
                    $("#ajax-table-status").removeClass('busy');
                }

                $("#contest-title").html(json.contest.title);


                if( json.teamA.goals == 0 && json.teamB.goals == 0 && (lastScoreTeamA == 10 || lastScoreTeamB == 10))
                {
                    $("#not-wrapper").show().fadeIn(2000, function(){
                        $('#not-end-msg').show().fadeIn(2000);
                    });
                }
                else
                {
                    $("#not-wrapper").hide().fadeOut(2000, function(){
                        $('#not-end-msg').hide().fadeOut(2000);
                    });

                    $("#scoreA").html(json.teamA.goals);
                    $("#scoreB").html(json.teamB.goals);
                    $("#player1-img").attr("src", json.teamA.player1.imageUrl + "?" + new Date().getTime());
                    $("#player2-img").attr("src", json.teamA.player2.imageUrl + "?" + new Date().getTime());
                    $("#player3-img").attr("src", json.teamB.player1.imageUrl + "?" + new Date().getTime());
                    $("#player4-img").attr("src", json.teamB.player2.imageUrl + "?" + new Date().getTime());
                }



                if(_firstTime)
                {
                    lastScoreTeamA = json.teamA.goals;
                    lastScoreTeamB = json.teamB.goals;
                    _firstTime = false;
                }
                else
                {
                    if(json.teamA.goals > lastScoreTeamA || json.teamB.goals > lastScoreTeamB)
                    {
                        $("#not-wrapper").show().fadeIn(2000, function(){
                            $('#not-goal-msg').show().fadeIn(2000).fadeOut(2000);
                        }).fadeOut(2000);
                    }
                    lastScoreTeamA = json.teamA.goals;
                    lastScoreTeamB = json.teamB.goals;
                }






            });

        },2000);

    });

</script>


<body>

{#{% block content%}#}

<div id="not-wrapper">
    <span id="not-goal-msg"> GOAL! </span>
    <span id="not-end-msg"> GAME OVER </br> Kick to start new game </span>
</div>

    <div class="live">

    <div class="container-fluid">
        <div class="row">

            <div class=" col-xs-12 col-sm-12 col-md-10 col-lg-8 col-md-offset-1 col-lg-offset-2 content">


                <div class="title">
                    <h1 id="contest-title"> {{ contest.title}} </h1>
                </div>


                <div class="row top-space" >
                    <div class="col-xs-12">
                       <span id="ajax-table-status" class="table-status">  </span>
                    </div>
                </div>

                <div id="scoreA"  class="score" >
                    {{ teamA.goals }}
                </div>
                <div id="scoreB" class="score" >
                    {{ teamB.goals }}
                </div>

                <div class="field">

                    <img class="bg" src="{{ asset('bundles/indigoui/images/field2.png') }}"/>

                        <div id="player1" class="player left-top">
                            <img id="player1-img" src="{{ teamA.player1.imageUrl }}"/>
                        </div>

                        <div class="player left-bottom">
                               <img id="player2-img" src="{{ teamA.player2.imageUrl }}"/>
                        </div>


                    <div class="player right-top">
                        {% if teamB.player1 != null %}
                            <img id="player3-img" src="{{ teamB.player1.imageUrl }}"/>
                        {% endif %}
                        {#<p> {{ player1.name }} </p>#}
                    </div>

                    <div class="player right-bottom">
                            <img id="player4-img" src="{{ teamB.player2.imageUrl }}"/>
                    </div>

                </div>

            </div>

        </div>

        <div class="row">

               <p class="status-message"> {{ statusMessage }} </p>

        </div>

        <div class="row">

        <div class="col-md-2">  </div>
        <div class="col-md-8 center">

            </div>
        </div>
    </div>

    </div>
</body>

</html>

{#{% endblock %}#}